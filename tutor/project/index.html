<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.20.1" />
    <meta name="description" content="HyperMake Document">
<meta name="author" content="Yisui Hu &lt;easeway@gmail.com&gt;">

    <link rel="shortcut icon" href="http://evo-cloud.github.com/hmake//images/favicon.png" type="image/x-icon" />

    
    <title>A HyperMake Project</title>
    <link href="http://evo-cloud.github.com/hmake//css/nucleus.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/font-awesome.min.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/hybrid.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/featherlight.min.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/horsey.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/theme.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/hugo-theme.css" rel="stylesheet">
    <script src="http://evo-cloud.github.com/hmake//js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    <link href="http://evo-cloud.github.com/hmake//css/default.css" rel="stylesheet">

  </head>
  <body class="" data-url="/hmake/tutor/project/">
    
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://evo-cloud.github.io/hmake"><b>H</b>yper<b>M</b>ake</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input id="search-by" type="text" placeholder="Search">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="http://evo-cloud.github.com/hmake//js/lunr.min.js"></script>
<script type="text/javascript" src="http://evo-cloud.github.com/hmake//js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/evo-cloud.github.com\/hmake\/";
</script>
<script type="text/javascript" src="http://evo-cloud.github.com/hmake//js/search.js"></script>

    
</div>


  <div class="highlightable">
    <ul class="topics">
      
        
        
          
          
            
          
        
          
          
            
          
        
          
          
            
          
        
          
          
            
          
        
        
        
          
        
          
        
          
        
          
        
      
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/hmake/intro/">
        <a href="/hmake/intro/">
          <span>
            
              <b>1. </b>
            
             Introduction
            
           </span>
        </a>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/hmake/quickguide/">
        <a href="/hmake/quickguide/">
          <span>
            
              <b>2. </b>
            
             Quick Guide
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/hmake/quickguide/install/">
              <a href="/hmake/quickguide/install/">
                <span>Installation     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/quickguide/helloworld/">
              <a href="/hmake/quickguide/helloworld/">
                <span>Hello World     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/hmake/tutor/">
        <a href="/hmake/tutor/">
          <span>
            
              <b>3. </b>
            
             Tutorials
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item active" data-nav-id="/hmake/tutor/project/">
              <a href="/hmake/tutor/project/">
                <span>A HyperMake Project     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/targetexec/">
              <a href="/hmake/tutor/targetexec/">
                <span>Target Execution     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/buildimage/">
              <a href="/hmake/tutor/buildimage/">
                <span>Build Docker Image     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/pushimage/">
              <a href="/hmake/tutor/pushimage/">
                <span>Push Docker Image     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/compose/">
              <a href="/hmake/tutor/compose/">
                <span>Docker Compose     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/execmode/">
              <a href="/hmake/tutor/execmode/">
                <span>Exec Mode     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/commandmode/">
              <a href="/hmake/tutor/commandmode/">
                <span>Command Mode     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/mapcreds/">
              <a href="/hmake/tutor/mapcreds/">
                <span>Map Credentials     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/targetexp/">
              <a href="/hmake/tutor/targetexp/">
                <span>Target Expansion     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/wrappermode/">
              <a href="/hmake/tutor/wrappermode/">
                <span>Wrapper Mode     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/faq/">
              <a href="/hmake/tutor/faq/">
                <span>FAQ     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/hmake/references/">
        <a href="/hmake/references/">
          <span>
            
              <b>4. </b>
            
             References
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/hmake/references/commandline/">
              <a href="/hmake/references/commandline/">
                <span>Command Line     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/references/fileformat/">
              <a href="/hmake/references/fileformat/">
                <span>File Format     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/references/dockerdrv/">
              <a href="/hmake/references/dockerdrv/">
                <span>Docker Driver     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <a class="btn btn-default" href="https://github.com/evo-cloud/hmake">Fork Me &nbsp;<i class="fa fa-github-alt"></i></a>

    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                
                  
                  
                  
                    
                    
                <a href="/hmake/tutor/" itemprop="url"><span itemprop="title">Tutorials</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> A HyperMake Project</span>
              </div>
              

            </div>
            
              <div id="body-inner">
                
                <h1>A HyperMake Project</h1>
                



<h2 id="project-layout">Project Layout</h2>

<p>A HyperMake project requires one <code>HyperMake</code> file in root directory of the
project (The file name can be overridden using <code>--file|-f</code>,
see <a href="/hmake/references/commandline/">Command Line</a> for details).
The command <code>hmake</code> can be invoked in any sub-directory of the project and it will
look up <code>HyperMake</code> to determine the root of project.</p>

<p>Similar to a <em>Makefile</em>, <em>HyperMake</em> defines targets with dependencies
(see <a href="/hmake/references/fileformat/">File Format</a>).
To better organize the targets, it&rsquo;s possible to break targets into multiple files.
Files other than the root <em>HyperMake</em> are modules and named with suffix
<code>.hmake</code>.
Use <code>includes</code> section to include all modules into one <em>HyperMake</em> file.</p>

<pre><code class="language-text">ProjectRoot
  |
  +--module1/
  | +--module.hmake
  +--module2/
  | +--module.hmake
  +--HyperMake
  +--.gitignore
</code></pre>

<p>In <em>HyperMake</em></p>

<pre><code>---
format: hypermake.v0
name: sample

includes:
  - **/**/*.hmake
</code></pre>

<p><code>name</code> is required in root <em>HyperMake</em>, but not in <code>*.hmake</code> modules.</p>

<p>In <code>.gitignore</code>, the following two lines are recommended:</p>

<pre><code>.hmake
.hmakerc
</code></pre>

<h2 id="state-directory">State Directory</h2>

<p>When <code>hmake</code> runs, it will create a state folder <code>.hmake</code> in the project root directory.
Within the folder, it tracks the execution result of targets, hmake logs,
output of targets, checksum of mtime of watched files and artifacts, and
also other files including generated scripts.</p>

<p>In most cases, this directory is irrelevant to the project and can be safely ignored.
However, it&rsquo;s very useful for analyzing the scripts/logs if something goes wrong.</p>

<h2 id="local-modules">Local Modules</h2>

<p><code>hmake</code> respects special files named <code>.hmakerc</code> when they are present.
They are the same as modules (<code>*.hmake</code>), but loaded after them.
The files specified after <code>--include|-I</code> are treated the same way but loaded last.</p>

<p>Here&rsquo;s the order to load files:</p>

<ul>
<li>Load <em>HyperMake</em> in project root;</li>
<li>Load all modules from <code>includes</code> section, recursively;</li>
<li>Find and load <code>.hmakerc</code> files from the folder launching <code>hmake</code> up to project root;</li>
<li>Load files specified by <code>--include|-I</code></li>
</ul>

<p>Usually, <code>.hmakerc</code> and files specified by <code>--include|-I</code> are excluded from
being committed to source control (in <code>.gitignore</code>), and are called <em>local modules</em>.
These files are used to override settings and
<a href="#dependency-injection">inject dependencies</a> for
the local needs of a developer.</p>

<div class="notices info" ><p>Local modules can override settings, inject dependencies, defining additional targets.
Existing targets can&rsquo;t be overridden/redefined.</p>
</div>


<h2 id="targets">Targets</h2>

<p>Targets are the basic execution units of a HyperMake project.
They are defined in <code>targets</code> section:</p>

<pre><code>---
format: hypermake.v0

targets:
  build:
    description: build the source code
    cmds:
      - ./build.sh
</code></pre>

<p>Targets have dependencies, which are defined using <code>before</code> and <code>after</code>:</p>

<pre><code>---
format: hypermake.v0

targets:
  toolchain:
    description: build docker image contains toolchain
    build: toolchain
  build:
    description: build the source code
    after:
      - toolchain
    cmds:
      - ./build.sh
settings:
  docker:
    image: mytoolchain
</code></pre>

<p>When run <code>hmake build</code>, <code>toolchain</code> will execute before <code>build</code>.</p>

<p><code>before</code> means the opposite, and is mostly used for dependency injection.</p>

<h2 id="dependency-injection">Dependency Injection</h2>

<p>This usually happens in <code>.hmakerc</code> and files specified by <code>--include|-I</code>.
In the file, define a target with <code>before</code> property, e.g. in <code>.hmakerc</code></p>

<pre><code>---
format: hypermake.v0

targets:
  pre-build:
    description: hook before build
    after: toolchain
    before: build
    cmds:
      - patch some files
</code></pre>


      
      
      </div>
    </div>

    
    
    
      
        
      
        
      
        
      
        
      
      
    
    
    
      
        
      
      
    
      
        
      
      
        
      
        
      
    
      
        
      
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
      
        
      
        
      
        
      
    
    

    <div id="navigation">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
            
              
                <a class="nav nav-prev" href="/hmake/tutor/"> <i class="fa fa-chevron-left"></i></a>
              
            
            
              
                <a class="nav nav-next" href="/hmake/tutor/targetexec/" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
              
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="http://evo-cloud.github.com/hmake//js/clipboard.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/perfect-scrollbar.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/perfect-scrollbar.jquery.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/jquery.sticky-kit.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/featherlight.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/html5shiv-printshiv.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="http://evo-cloud.github.com/hmake//js/modernizr.custom.71422.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/learn.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/hugo-learn.js"></script>
    

  </body>
</html>

