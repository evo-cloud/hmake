<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.20.1" />
    <meta name="description" content="HyperMake Document">
<meta name="author" content="Yisui Hu &lt;easeway@gmail.com&gt;">

    <link rel="shortcut icon" href="http://evo-cloud.github.com/hmake//images/favicon.png" type="image/x-icon" />

    
    <title>Hello World</title>
    <link href="http://evo-cloud.github.com/hmake//css/nucleus.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/font-awesome.min.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/hybrid.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/featherlight.min.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/horsey.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/theme.css" rel="stylesheet">
    <link href="http://evo-cloud.github.com/hmake//css/hugo-theme.css" rel="stylesheet">
    <script src="http://evo-cloud.github.com/hmake//js/jquery-2.x.min.js"></script>
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    <link href="http://evo-cloud.github.com/hmake//css/default.css" rel="stylesheet">

  </head>
  <body class="" data-url="/hmake/quickguide/helloworld/">
    
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://evo-cloud.github.io/hmake"><b>H</b>yper<b>M</b>ake</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input id="search-by" type="text" placeholder="Search">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="http://evo-cloud.github.com/hmake//js/lunr.min.js"></script>
<script type="text/javascript" src="http://evo-cloud.github.com/hmake//js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/evo-cloud.github.com\/hmake\/";
</script>
<script type="text/javascript" src="http://evo-cloud.github.com/hmake//js/search.js"></script>

    
</div>


  <div class="highlightable">
    <ul class="topics">
      
        
        
          
          
            
          
        
          
          
            
          
        
          
          
            
          
        
          
          
            
          
        
        
        
          
        
          
        
          
        
          
        
      
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/hmake/intro/">
        <a href="/hmake/intro/">
          <span>
            
              <b>1. </b>
            
             Introduction
            
           </span>
        </a>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  parent" data-nav-id="/hmake/quickguide/">
        <a href="/hmake/quickguide/">
          <span>
            
              <b>2. </b>
            
             Quick Guide
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/hmake/quickguide/install/">
              <a href="/hmake/quickguide/install/">
                <span>Installation     </i></span>
              </a>
            </li>
          
            <li class="dd-item active" data-nav-id="/hmake/quickguide/helloworld/">
              <a href="/hmake/quickguide/helloworld/">
                <span>Hello World     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/hmake/tutor/">
        <a href="/hmake/tutor/">
          <span>
            
              <b>3. </b>
            
             Tutorials
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/project/">
              <a href="/hmake/tutor/project/">
                <span>A HyperMake Project     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/targetexec/">
              <a href="/hmake/tutor/targetexec/">
                <span>Target Execution     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/buildimage/">
              <a href="/hmake/tutor/buildimage/">
                <span>Build Docker Image     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/pushimage/">
              <a href="/hmake/tutor/pushimage/">
                <span>Push Docker Image     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/compose/">
              <a href="/hmake/tutor/compose/">
                <span>Docker Compose     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/execmode/">
              <a href="/hmake/tutor/execmode/">
                <span>Exec Mode     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/commandmode/">
              <a href="/hmake/tutor/commandmode/">
                <span>Command Mode     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/mapcreds/">
              <a href="/hmake/tutor/mapcreds/">
                <span>Map Credentials     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/targetexp/">
              <a href="/hmake/tutor/targetexp/">
                <span>Target Expansion     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/wrappermode/">
              <a href="/hmake/tutor/wrappermode/">
                <span>Wrapper Mode     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/tutor/faq/">
              <a href="/hmake/tutor/faq/">
                <span>FAQ     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
      

      
      
      
        
          
        
      
      
      

      <li class="dd-item  " data-nav-id="/hmake/references/">
        <a href="/hmake/references/">
          <span>
            
              <b>4. </b>
            
             References
            
           </span>
        </a>
        
        <ul>
          
            <li class="dd-item " data-nav-id="/hmake/references/commandline/">
              <a href="/hmake/references/commandline/">
                <span>Command Line     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/references/fileformat/">
              <a href="/hmake/references/fileformat/">
                <span>File Format     </i></span>
              </a>
            </li>
          
            <li class="dd-item " data-nav-id="/hmake/references/dockerdrv/">
              <a href="/hmake/references/dockerdrv/">
                <span>Docker Driver     </i></span>
              </a>
            </li>
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
     
    <section id="footer">
      <a class="btn btn-default" href="https://github.com/evo-cloud/hmake">Fork Me &nbsp;<i class="fa fa-github-alt"></i></a>

    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                
                  
                  
                  
                    
                    
                <a href="/hmake/quickguide/" itemprop="url"><span itemprop="title">Quick Guide</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> Hello World</span>
              </div>
              

            </div>
            
              <div id="body-inner">
                
                <h1>Hello World</h1>
                



<h2 id="a-simple-project">A Simple Project</h2>

<p>Let&rsquo;s make a simple <em>Hello World</em> C++ project,
and see how HyperMake can help.</p>

<p>Here&rsquo;s the project directory layout:</p>

<pre><code class="language-text">ProjectRoot
  |
  +--inc/
  +--src/
      +--hello.cpp
</code></pre>

<p>In <em>hello.cpp</em>:</p>

<pre><code>#include &lt;iostream&gt;

int main(int argc, char *argv[]) {
    std::cout &lt;&lt; &quot;Hello World!&quot; &lt;&lt; std::endl;
    return 0;
}
</code></pre>

<p>To build it, use <code>g++ -o hello src/hello.cpp</code>.
Probably you will need to run <code>sudo apt install g++</code> first on Debian/Ubuntu if
you&rsquo;ve never installed the toolchain.
Fortunately, using <code>HyperMake</code>, you don&rsquo;t need to worry about that on your host.</p>

<h2 id="the-hypermake-file">The <em>HyperMake</em> file</h2>

<p><code>HyperMake</code> is a YAML file which sits in the root directory of source tree.</p>

<pre><code>---
format: hypermake.v0
name: hello
description: The Hello World Project
</code></pre>

<div class="notices tip" ><p>The first line <code>---</code> indicates the start of a new document in YAML</p>
</div>


<ul>
<li><code>format</code> is required and must be <code>hypermake.v0</code>.
<em>hmake</em> only accepts YAML files with <code>format: hypermake.v0</code>.</li>
<li><code>name</code> specifies the project name, which is required.</li>
<li><code>description</code> gives more information about the project. It&rsquo;s optional.</li>
</ul>

<h2 id="targets">Targets</h2>

<p>Like <em>make</em>, the minimum execution unit is target:</p>

<pre><code>---
format: hypermake.v0
name: hello
description: The Hello World Project

targets:
  build:
    description: build hello binary
    image: 'gcc:4.9'
    cmds:
      - g++ -o hello src/hello.cpp
</code></pre>

<p>The target <em>build</em> is defined. It has three properties:</p>

<ul>
<li><code>description</code>: a brief intro about what the target does;</li>
<li><code>image</code>: the docker image to create the container and run commands;</li>
<li><code>cmds</code>: a list of commands to execute inside the container.</li>
</ul>

<p>Now, let&rsquo;s do</p>

<pre><code>hmake build
./hello
</code></pre>

<p>It shows <code>Hello World</code>.</p>

<p>It always builds even if you don&rsquo;t have <em>g++</em> installed on the host.</p>

<h2 id="default">Default</h2>

<p>If typing <code>hmake build</code> is boring, defining default targets can simplify the
command as a single <code>hmake</code>.</p>

<pre><code>---
format: hypermake.v0
name: hello
description: The Hello World Project

targets:
  build:
    description: build hello binary
    image: 'gcc:4.9'
    cmds:
      - g++ -o hello src/hello.cpp

settings:
  default-targets:
    - build
</code></pre>

<p>Now, typing <code>hmake</code> is equivalent to <code>hmake build</code>.</p>

<p>More settings can be added.
For example all the targets use the same image, it can be moved to <code>settings</code>.</p>

<pre><code>---
format: hypermake.v0
name: hello
description: The Hello World Project

targets:
  build:
    description: build hello binary
    cmds:
      - g++ -o hello src/hello.cpp

settings:
  default-targets:
    - build
  docker:
    image: 'gcc:4.9'
</code></pre>

<p>All targets will have <code>image: 'gcc:4.9'</code> by default, unless explicitly specified
in target.</p>

<h2 id="watches-and-artifacts">Watches and Artifacts</h2>

<p>Let&rsquo;s do some tricks here: <code>touch src/hello.cpp</code> or modify the file, and then
type <code>hmake</code>. You will see the <code>build</code> target is skipped:</p>

<pre><code class="language-text">HyperMake v1.1.0 https://github.com/evo-cloud/hmake

=&gt; build 21:56:42.277
:] build
╔══════╤═══════╤════════╤════════════╤════════════╤═════╗
║Target│Result │Duration│Start       │Finish      │Error║
╠══════╪═══════╪════════╪════════════╪════════════╪═════╣
║build │Skipped│        │21:56:42.277│21:56:42.277│     ║
╚══════╧═══════╧════════╧════════════╧════════════╧═════╝
OK
</code></pre>

<p>This is definitely not what we want.
However <em>hmake</em> doesn&rsquo;t have the knowledge about source files and output files.
It must be explicitly specified using <code>watches</code> and/or <code>artifacts</code>:</p>

<pre><code>targets:
  build:
    description: build hello binary
    watches:
      - inc
      - src
    cmds:
      - g++ -o hello src/hello.cpp
    artifacts:
      - hello
</code></pre>

<p>The items in <code>watches</code> can be a path to a directory or a file, or with wildcards
matching a list of files/directories.
If the item is a directory, all sub-directories and files are watched recursively.
<code>artifacts</code> lists the output files.
Wildcard is not allowed here, and directory is not matched recursively.
<em>hmake</em> rebuilds the target if any of the watched file is changed or
any artifact is missing.</p>

<h2 id="dependencies">Dependencies</h2>

<p>As the project is so simple that we can use an existing docker image <code>gcc:4.9</code> which
contains toolchain we need.
However in most cases, the public docker images are not always good enough, and
we want to install extra bits to build the project.
Then we need to build our own toolchain image.</p>

<p>Let&rsquo;s use <code>cmake</code> to build our project,
by adding <code>CMakeList.txt</code> under project root:</p>

<pre><code>cmake_minimum_required(VERSION 2.8.0)
project(hello CXX)
include_directories(&quot;inc&quot;)
add_executable(hello src/hello.cpp)
</code></pre>

<p>Then we will need <code>cmake</code> in toolchain image, let&rsquo;s build one based on <code>gcc:4.9</code>.
Create a folder <code>toolchain</code> under project root and put a <code>Dockerfile</code> inside it:</p>

<pre><code class="language-text">ProjectRoot
  |
  +--inc/
  +--src/
  | +--hello.cpp
  +--toolchain/
  | +--Dockerfile
  +--HyperMake
  +--CMakeList.txt
</code></pre>

<p>In <code>Dockerfile</code>:</p>

<pre><code>FROM gcc:4.9
RUN apt-get update &amp;&amp; apt-get install -y cmake &amp;&amp; apt-get clean
</code></pre>

<p>And update <code>HyperMake</code>:</p>

<pre><code>---
format: hypermake.v0
name: hello
description: The Hello World Project

targets:
  toolchain:
    description: build our own toolchain image
    watches:
      - toolchain
    build: toolchain

  build:
    description: build hello binary
    after:
      - toolchain
    watches:
      - inc
      - src
    cmds:
      - rm -fr rel &amp;&amp; mkdir -p rel
      - cd rel &amp;&amp; cmake .. &amp;&amp; make
    artifacts:
      - rel/hello

settings:
  default-targets:
    - build
  docker:
    image: 'cmake-gcc:4.9'
</code></pre>

<p>Target <code>toolchain</code> is added. Property <code>build</code> tells <em>hmake</em> to build a
docker image from <code>toolchain/Dockerfile</code>.
And as <code>image: cmake-gcc:4.9</code> is specified in <code>settings</code>,
the built image will be <code>cmake-gcc:4.9</code>.</p>

<p>In target <code>build</code>, property <code>after</code> specifies <code>toolchain</code> must succeed
before <code>build</code> is able to run.</p>

<p>Now, type <code>hmake</code> and it will first run <code>toolchain</code> to build <code>cmake-gcc:4.9</code> and
the run <code>build</code> to call <code>cmake</code> to build the binary.</p>


      
      
      </div>
    </div>

    
    
    
      
        
      
        
      
        
      
        
      
      
    
    
    
      
        
      
      
    
      
        
      
      
        
      
        
      
    
      
        
      
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
      
        
      
        
      
        
      
    
    

    <div id="navigation">
        
        
        
          
        
          
        
          
        
          
            
              
                <a class="nav nav-prev" href="/hmake/quickguide/install/"> <i class="fa fa-chevron-left"></i></a>
              
            
            
              
                <a class="nav nav-next" href="/hmake/tutor/" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
              
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="http://evo-cloud.github.com/hmake//js/clipboard.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/perfect-scrollbar.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/perfect-scrollbar.jquery.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/jquery.sticky-kit.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/featherlight.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/html5shiv-printshiv.min.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="http://evo-cloud.github.com/hmake//js/modernizr.custom.71422.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/learn.js"></script>
    <script src="http://evo-cloud.github.com/hmake//js/hugo-learn.js"></script>
    

  </body>
</html>

